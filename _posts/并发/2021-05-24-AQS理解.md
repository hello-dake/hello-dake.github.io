---
layout: post
title: "AQS理解"
categories: 并发
date: 2021-05-24
---

AQS，AbstractQueuedSynchronizer是一个用来构建锁和同步器的框架

里面有三个组件

1.state变量，表示锁状态

2.线程变量，表示当前持有锁的线程

3.等待队列，用于存放等待获取锁的线程

核心方法：
lock()   unlock()

实现原理：

以ReentrantLock来举例，如果线程1来请求锁，state初始状态为0，
通过自旋转CAS将state从0改为1，如果成功，那么将线程变量设为当前线程。获取锁成功。

在线程1获取锁的情况下，这个时候如果线程2也来获取锁，首先查看state的
值不为0，然后去判断线程变量里是不是当前线程本身，如果是自己，那么
state的值+1，因为可重入锁，如果不是自己，说明已经有人加锁，线程2进入等待
队列等待线程1释放锁。

释放锁：线程1执行完业务逻辑，将state的值递减1，如果state的值变为0，
那么说明锁已经被释放，这个时候会将线程变量中的值置为null，并且唤醒等待
队列中的第一个节点。

### state 状态

ReentrantLock：线程重入锁的次数；

Semaphere：剩余的许可数量；

FutureTask：任务的状态。

## 并发工具类


### CountDownLatch
一个或多个线程等待其他线程完成操作。

### CycleBarrier
多个线程相互等待。一个或者一组线程完成操作以后到达一个屏障，直到最后一个也到达。

### Semephere
信号量。控制同时访问资源的线程数量。
